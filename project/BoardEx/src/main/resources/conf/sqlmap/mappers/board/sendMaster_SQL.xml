<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.board.send.service.impl.BoardMapper">
	<resultMap id="boardResult" type="BoardVO" />

	<!-- 게시판 마스터 목록 조회 -->
	<select id="selectBoardList" parameterType="BoardVO" resultMap="boardResult">
		<![CDATA[
		/* board_SQL.selectBoardList */
		SELECT
			SM.SEND_IDX, SM.MSG_CONTENT, SM.OS_TYPE, SM.REG_ID, SM.USER_ID,
			DATE_FORMAT(SM.SEND_DT, '%Y-%m-%d %H:%i') AS SEND_DT,
			DATE_FORMAT(SM.PUSH_REQ_DT, '%Y-%m-%d %H:%i') AS PUSH_REQ_DT,
			SM.PUSH_REQ_STS, SM.PUSH_RES_STS
		FROM
			SEND_MASTER AS SM
		WHERE
			1=1
		]]>
		<if test='searchOsType != null and searchOsType != ""'>
    	<![CDATA[
			AND SM.OS_TYPE = #{searchOsType}
    	]]>
		</if>
		<if test='searchPushReqSts != null and searchPushReqSts != ""'>
    	<![CDATA[
			AND SM.PUSH_REQ_STS = #{searchPushReqSts}
    	]]>
		</if>
		<if test='searchMsgContent != null and searchMsgContent != ""'>
		<![CDATA[
			AND SM.MSG_CONTENT LIKE CONCAT('%',#{searchMsgContent},'%')
		]]>
		</if>
		<![CDATA[
		ORDER BY
			SM.SEND_DT DESC
		LIMIT #{startRownum}, #{cntPerPage}
		]]>
	</select>

	<!-- 게시판 마스터 목록 총 갯수 -->
	<select id="selectBoardListTotalCnt" parameterType="BoardVO" resultType="int">
		<![CDATA[
		/* board_SQL.selectBoardListTotalCnt */
		SELECT
			COUNT(*) AS TOTAL_CNT
		FROM
			SEND_MASTER AS SM
		WHERE
			1=1
		]]>
		<if test='searchOsType != null and searchOsType != ""'>
    	<![CDATA[
			AND SM.OS_TYPE = #{searchOsType}
    	]]>
		</if>
		<if test='searchPushReqSts != null and searchPushReqSts != ""'>
    	<![CDATA[
			AND SM.PUSH_REQ_STS = #{searchPushReqSts}
    	]]>
		</if>
		<if test='searchMsgContent != null and searchMsgContent != ""'>
		<![CDATA[
			AND SM.MSG_CONTENT LIKE CONCAT('%',#{searchMsgContent},'%')
		]]>
		</if>
	</select>

	<!-- 게시판 마스터 조회 -->
	<select id="selectBoard" parameterType="BoardVO" resultMap="boardResult">
		<![CDATA[
		/* board_SQL.selectBoardList */
		SELECT
			SM.SEND_IDX, SM.MSG_CONTENT, SM.OS_TYPE, SM.REG_ID, SM.USER_ID,
			DATE_FORMAT(SM.SEND_DT, '%Y-%m-%d %H:%i') AS SEND_DT,
			DATE_FORMAT(SM.PUSH_REQ_DT, '%Y-%m-%d %H:%i') AS PUSH_REQ_DT,
			SM.PUSH_REQ_STS, SM.PUSH_RES_STS
		FROM
			SEND_MASTER AS SM
		WHERE
			SM.SEND_IDX = #{sendIdx}
		]]>
	</select>

	<!-- 게시판 마스터 등록 -->
	<insert id="insertBoard" parameterType="BoardVO">
		<![CDATA[
		/* board_SQL.insertBoard */
		INSERT INTO SEND_MASTER
		(
			MSG_CONTENT, OS_TYPE, REG_ID, USER_ID, SEND_DT, PUSH_REQ_DT, PUSH_REQ_STS, PUSH_RES_STS
		)
		VALUES
		(
			#{msgContent}, #{osType}, #{regId}, #{userId, jdbcType=VARCHAR}, NOW(), NULL, 'N', NULL
		)
		]]>
	</insert>

</mapper>